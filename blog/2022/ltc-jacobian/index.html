<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Jacobian of the LTC transformation | Aakash KT</title> <meta name="author" content="Aakash KT"/> <meta name="description" content="Deriving the jacobian of the LTC transform. In-detail walkthrough."/> <meta name="keywords" content="aakashkt, real-time-rendering, computer-graphics, ray-tracing, path-tracing"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://aakashkt.github.io/blog/2022/ltc-jacobian/"> <link rel="stylesheet" href="assets/css/image_comparison_style.css"> <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> <script src="assets/js/image_comparison.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://aakashkt.github.io//">Aakash KT</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">Home</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Jacobian of the LTC transformation</h1> <p class="post-meta">June 11, 2022</p> <hr> </header> <article class="post-content"> <p>My recent <a href="ltc_anisotropic.html">paper</a> builds on this <a href="https://eheitzresearch.wordpress.com/415-2/" target="_blank" rel="noopener noreferrer">Linearly Transformed Cosines paper</a> by Eric Heitz. Infact, this was a collaboration with Eric himself! Linearly Tranformed Cosines or LTCs are a transformation of the rendering integral under specific assumptions, which lead to analytic solutions of it. One of the outcomes of my new work was the relaxation of the isotropic assumption of LTCs, allowing the use of anisotropic BRDFs.</p> <p>Although I have read the original paper countless times and worked on an extension of it, I still was puzzled by the LTC jacobian derivation given in the appendix of the original paper:</p> <p><br></p> <div class="row" align="center"> <div class="col-sm-6"> <img src="/assets/img/ltc_jac_1.png"> </div> <div class="col-sm-6"> <img src="/assets/img/ltc_jac_2.png"> </div> </div> <div class="row" align="center"> <div class="col-sm-12"> <b>Figure 1:</b> LTC jacobian derivation from the <a href="https://eheitzresearch.wordpress.com/415-2/" target="_blank" rel="noopener noreferrer">original paper.</a> </div> </div> <p><br></p> <p>The derivation must be pretty obvious to a lot of people but to me it wasn’t so. This post is an attempt to give a detailed and intuitive derivation of this expression (Eq. 18 above). Why is this important? Well, in my view small details like these expand your horizon, and you can only hope to get new ideas if you throughly understand what’s already out there. Also, its always fun to understand things from a mathematical perspective, even if you are a intuitive-first person like I am.</p> <p>I would like to note that figures in this post have been directly taken from the <a href="https://eheitzresearch.wordpress.com/415-2/" target="_blank" rel="noopener noreferrer">original paper.</a></p> <p><br></p> <h2 id="definitions">Definitions</h2> <p>Its best if you have read and are confortable with Eric’s original paper. However, I am still defining things here to ensure consistency.</p> <p>Direction vectors on the unit sphere are given by \(\omega = (x, y, z)\). \(D_o(\omega_o)\) is the source (clamped cosine) distribution. \(D(\omega)\) is the target (~ GGX BRDF) distribution. Given an LTC matrix \(M\), the direction vectors \(\omega\) of \(D\) are obtained by from the direction vectors \(\omega_o\) of \(D_o\) by:</p> <p> $$ \omega = \frac{M\omega_o}{|| M\omega_o ||}. $$ </p> <p>The magnitude at the transformed direction is given by:</p> <p> $$ \boxed{ D(\omega) = D_o(\omega_o) \frac{\partial \omega_o}{\partial \omega}. } $$ </p> <p>Here, \(\frac{\partial \omega_o}{\partial \omega}\) is the determinant of jacobian of the transformation (which is frequently referred to as just the jacobian). This is what we will derive in this post.</p> <p>Another thing we will find useful is the <a href="https://en.wikipedia.org/wiki/Solid_angle#:~:text=Thus%20one%20can,the%20viewer%20as%3A" target="_blank" rel="noopener noreferrer">solid angle subtended by a small facet</a> having area \(A\), which is given by:</p> <p> $$ \partial \omega = \frac{A (\hat{r} \cdot \hat{n})}{r^2}, $$ </p> <p>where \(\partial\omega\) is a small solid angle, \(\hat{r}\) is the normalized position vector of the facet, \(\hat{n}\) is the surface normal of the facet and \(r^2\) is the distance to the facet.</p> <p>Finally, we will find use of the <a href="https://en.wikipedia.org/wiki/Cross_product#:~:text=More%20generally%2C%20the%20cross%20product%20obeys%20the%20following%20identity%20under%20matrix%20transformations%3A" target="_blank" rel="noopener noreferrer"> cross product under linear transforms</a> property:</p> <p> $$ M\omega_1 \times M\omega_2 = |M| M^{-T} (\omega_1 \times \omega_2) = |M| M^{-T} \omega_o $$ </p> <p><br></p> <h2 id="derivation">Derivation</h2> <p>First things first. Note that \(D\) and \(D_o\) are distributions in <b>2D</b>, although they appear to be distributions in 3D. To see why, note that these are distributions on the unit sphere. Hence, we can write \(\omega = (\sin\theta \cos\phi, \sin\theta \sin\phi, \cos\theta)\), in turn making \(D\) and \(D_o\) dependent on only \(\theta, \phi\) (thus two dimensional).</p> <p>From the <a href="https://en.wikipedia.org/wiki/Jacobian_matrix_and_determinant#:~:text=Jacobian%20determinant%5Bedit%5D" target="_blank" rel="noopener noreferrer">definition of jacobian determinants</a>, \(\frac{\partial \omega_o}{\partial \omega}\) measures how a differential area around \(\omega_o\) changes. Since this differential area in on the unit sphere, it is basically the <a href="https://en.wikipedia.org/wiki/Solid_angle" target="_blank" rel="noopener noreferrer">solid angle</a>. <b>The LTC jacobian thus measures change in solid angle under the LTC transform</b>.</p> <p>Our problem now boils down to determining how a differential solid angle changes under \(M\).</p> <p>Let’s take the differential solid angle \(\color{red}\partial\omega_o\) in \(D_o\). Since this is small enough, it can also be considered as a planar facet. Now, define two vectors \(\omega_1, \omega_2\), which together with \(\omega_o\) form an orthonormal basis. (Figure 2, left)</p> <div class="row" align="center"> <div class="col-sm-12"> <img src="/assets/img/do_solid_angle.png" style="width: 600px"> </div> </div> <div class="row" align="center"> <div class="col-sm-12"> <b>Figure 2:</b> Left: Orthonormal basis in D<sub>o</sub>; Right: The same basis transformed by M. </div> </div> <p><br></p> <p>Transforming these vectors by LTC \(M\) results in a new set of vectors (Figure 2, right). The area of the facet \(\color{red}\partial\omega_o\) is now changed to \(\color{red}\partial\omega_o \cdot A\), where \(A\) is the area of parallelogram defined by vectors \(M\omega_1\) and \(M\omega_2\).</p> <p>A subtelty you may want to note, is that in Figure 2 left, the area of the parallelogram given by \(\omega_1\) and \(\omega_2\) is \(1\), thus the differential area is only \(\partial\omega_o\). This changes in Figure 2 right, since the area of the parallelogram is not \(1\) anymore, and thus the differential area is \(\partial\omega_o \cdot A\).</p> <p>Alright! Now how about the differential solid angle \(\color{green}\partial\omega\) after the LTC transform? Its essentialy the <b>solid angle subtended by a small facet</b>! We know this directly (see definitions section):</p> <p> $$ \partial\omega = \frac{\partial\omega_o A (\hat{r} \cdot \hat{n})}{r^2}. $$ </p> <p>The terms \(\hat{r}, \hat{n}\) and \(A\) are simple to define in this case.</p> <p>The area is \(A = \|M\omega_1 \times M\omega_2\|\), which is a <a href="https://en.wikipedia.org/wiki/Cross_product" target="_blank" rel="noopener noreferrer">standard formula.</a></p> <p>The unit position vector is \(\hat{r} = \frac{M\omega_o}{\|M\omega_o\|}\) (the division just normalizes since \(\hat{r}\) is a unit vector).</p> <p>And finally, the normal vector is \(\hat{n} = \frac{M\omega_1 \times M\omega_2}{\|M\omega_1 \times M\omega_2\|}\) (again, division for normalization).</p> <p>Lets first simplify the dot product \(\hat{r} \cdot \hat{n}\) by plugging in the above definitions:</p> <p> $$ \hat{r} \cdot \hat{n} = \left( \frac{M\omega_o}{\|M\omega_o\|} \right)^T \frac{M\omega_1 \times M\omega_2}{\|M\omega_1 \times M\omega_2\|} $$ </p> <p>Using <b>coss product under linear transforms</b> property:</p> <p> $$ \hat{r} \cdot \hat{n} = \frac{(M\omega_o)^T}{\|M\omega_o\|} \frac{|M| M^{-T} \omega_o}{\|M\omega_1 \times M\omega_2\|} $$ $$ \ \ \ \ \ \ = \frac{|M| (M\omega_o)^T M^{-T} \omega_o}{\|M\omega_o\| \|M\omega_1 \times M\omega_2\|} $$ </p> <p>Using the fact that \((M\omega_o)^T = \omega_o^T M^T\):</p> <p> $$ \ \ \ \ \ \ = \frac{|M| \omega_o^{T}{\color{red}M^T M^{-T}} \omega_o}{\|M\omega_o\| \|M\omega_1 \times M\omega_2\|} $$ $$ \ \ \ \ \ \ = \frac{|M| {\color{red}\omega_o^{T} \omega_o}}{\|M\omega_o\| \|M\omega_1 \times M\omega_2\|} $$ </p> <p>\(\omega_o^T\omega_o\) is equal to \(1\), since \(\omega_o\) is a unit vector.</p> <p> $$ \Longrightarrow \hat{r} \cdot \hat{n} = \frac{|M|}{\|M\omega_o\| \|M\omega_1 \times M\omega_2\|} $$ </p> <p>Finally, substitue into and simplify the expression for \(\partial\omega\):</p> <p> $$ \partial\omega = \frac{\partial\omega_o A (\hat{r} \cdot \hat{n})}{r^2} $$ $$ \frac{\partial\omega}{\partial\omega_o} = \frac{A (\hat{r} \cdot \hat{n})}{r^2} $$ $$ \Longrightarrow \frac{\partial\omega}{\partial\omega_o} = \frac{ {\color{red}\|M\omega_1 \times M\omega_2\|} }{\|M\omega_o\|^2} \frac{|M|}{\|M\omega_o\| {\color{red} \|M\omega_1 \times M\omega_2\|} } $$ $$ \boxed{ \Longrightarrow \frac{\partial\omega}{\partial\omega_o} = \frac{|M|}{\|M\omega_o\|^3}. } $$ </p> <p>This is what we are looking for! <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20"></p> <p><br></p> <h2 id="conclusion">Conclusion</h2> <p>This is a pretty intuitive proof, given that you think and go about it the right way. Hope this post helps some of you in your own research journey!</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Aakash KT. Aakash KT Last updated: August 10, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>